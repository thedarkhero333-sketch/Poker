<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Poker Online</title>
<script src="/socket.io/socket.io.js"></script>

<style>

body{
  margin:0;
  background:#0e1a2b;
  font-family:Arial;
  color:white;
  text-align:center;
}

h1{
  margin:15px;
}

#table{
  width:850px;
  height:500px;
  margin:20px auto;
  background:radial-gradient(circle at center,#1e7d3c 0%,#115c2c 70%);
  border-radius:250px;
  position:relative;
  border:12px solid #5a3e1b;
}

.seat{
  width:140px;
  height:120px;
  background:#1c1c1c;
  border-radius:12px;
  position:absolute;
  padding:5px;
  font-size:14px;
}

.turn{
  border:2px solid gold;
}

.card{
  display:inline-block;
  width:55px;
  height:80px;
  background:white;
  border-radius:8px;
  margin:3px;
  font-weight:bold;
  font-size:20px;
  line-height:80px;
}

.red{ color:red; }
.black{ color:black; }

.hidden{
  background:#222;
}

#community{
  position:absolute;
  top:45%;
  left:50%;
  transform:translate(-50%,-50%);
}

#pot{
  font-size:22px;
  margin-top:10px;
}

#winnerText{
  margin-top:10px;
  font-size:20px;
  color:gold;
  min-height:30px;
}

button{
  padding:8px 15px;
  margin:5px;
  font-size:15px;
  cursor:pointer;
  border-radius:6px;
  border:none;
}

#controls{
  margin-top:20px;
}

</style>
</head>
<body>

<h1>♠ Texas Hold'em ♣</h1>

<div id="pot">Pozo: $0</div>

<div id="table">
  <div id="community"></div>
</div>

<div id="winnerText"></div>

<div id="controls">
  <button onclick="check()">Check</button>
  <button onclick="bet(5)">$5</button>
  <button onclick="bet(10)">$10</button>
  <button onclick="bet(20)">$20</button>
  <button onclick="fold()">Fold</button>
</div>

<script>

const socket = io();
let myId=null;
let currentTurn=null;
let revealCards=false;

socket.on("connect",()=>{
  myId=socket.id;
});

socket.on("update",data=>{

  currentTurn=data.gameState.turn;
  revealCards=data.gameState.reveal;

  document.getElementById("pot").innerText=
    "Pozo: $"+data.gameState.pot;

  renderCommunity(data.gameState.community);
  renderPlayers(data.players);
});

socket.on("showdown",data=>{
  document.getElementById("winnerText").innerText=
    "Ganador: "+getPlayerName(data.winner)+" con "+data.description;
});

function getPlayerName(id){
  const seats=document.querySelectorAll(".seat");
  for(let s of seats){
    if(s.dataset.id===id) return s.dataset.name;
  }
  return "";
}

function renderCommunity(cards){
  const div=document.getElementById("community");
  div.innerHTML="";
  cards.forEach(c=>{
    div.appendChild(createCard(c));
  });
}

function createCard(text){
  const div=document.createElement("div");
  div.className="card";

  const suit=text.slice(-1);
  const value=text.slice(0,-1);

  if(suit==="♥"||suit==="♦")
    div.classList.add("red");
  else
    div.classList.add("black");

  div.innerText=value+suit;
  return div;
}

function renderPlayers(players){

  document.querySelectorAll(".seat").forEach(e=>e.remove());

  const positions=[
    {top:"5%",left:"45%"},
    {top:"20%",left:"80%"},
    {top:"65%",left:"80%"},
    {top:"80%",left:"45%"},
    {top:"65%",left:"5%"},
    {top:"20%",left:"5%"}
  ];

  players.forEach((p,index)=>{

    const seat=document.createElement("div");
    seat.className="seat";
    seat.style.top=positions[index].top;
    seat.style.left=positions[index].left;
    seat.dataset.id=p.id;
    seat.dataset.name=p.name;

    if(p.id===currentTurn)
      seat.classList.add("turn");

    let cardsHtml="";

    if(p.id===myId || revealCards){
      p.cards.forEach(c=>{
        cardsHtml+=createCardHTML(c);
      });
    }else if(!p.folded){
      cardsHtml+=`
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      `;
    }

    seat.innerHTML=`
      <div><b>${p.name}</b></div>
      <div>$${p.money}</div>
      ${cardsHtml}
    `;

    document.getElementById("table").appendChild(seat);
  });
}

function createCardHTML(c){
  const suit=c.slice(-1);
  const value=c.slice(0,-1);
  const color=(suit==="♥"||suit==="♦")?"red":"black";
  return `<div class="card ${color}">${value}${suit}</div>`;
}

function bet(amount){
  socket.emit("bet",amount);
}

function check(){
  socket.emit("bet",0);
}

function fold(){
  socket.emit("fold");
}

</script>

</body>
</html>
