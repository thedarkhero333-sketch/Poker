<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Poker Online</title>
<script src="/socket.io/socket.io.js"></script>

<style>

body{
  margin:0;
  background:#0b1522;
  font-family:Arial, Helvetica, sans-serif;
  color:white;
  text-align:center;
}

h1{
  margin:15px;
}

#pot{
  font-size:22px;
  margin-top:5px;
}

#winnerText{
  height:30px;
  margin-top:10px;
  font-size:20px;
  color:gold;
}

#table{
  width:900px;
  height:520px;
  margin:20px auto;
  background:radial-gradient(circle at center,#1f7a3d 0%,#125b2b 70%);
  border-radius:300px;
  position:relative;
  border:14px solid #5a3e1b;
  box-shadow:0 0 40px rgba(0,0,0,0.6);
}

/* ASIENTOS */

.seat{
  width:170px;
  height:150px;
  background:#1b1b1b;
  border-radius:14px;
  position:absolute;
  padding:8px;
  font-size:14px;
  box-shadow:0 0 10px rgba(0,0,0,0.7);
}

.turn{
  box-shadow:0 0 15px gold;
}

/* ROLES */

.role{
  position:absolute;
  top:-10px;
  right:-10px;
  width:28px;
  height:28px;
  border-radius:50%;
  font-size:13px;
  line-height:28px;
  font-weight:bold;
  color:black;
}

.dealer{ background:gold; }
.sb{ background:#3fa9f5; color:white; }
.bb{ background:#ff4d4d; color:white; }

/* CARTAS */

.card{
  display:inline-block;
  width:65px;
  height:95px;
  background:white;
  border-radius:10px;
  margin:4px;
  position:relative;
  border:1px solid #aaa;
  box-shadow:0 3px 6px rgba(0,0,0,0.4);
  font-weight:bold;
}

.card .top{
  position:absolute;
  top:5px;
  left:6px;
  font-size:15px;
}

.card .bottom{
  position:absolute;
  bottom:5px;
  right:6px;
  font-size:15px;
  transform:rotate(180deg);
}

.card .center{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:28px;
}

.red{ color:#d60000; }
.black{ color:#000; }

.hidden{
  background:linear-gradient(45deg,#1e3c72,#2a5298);
  border:1px solid #222;
}

/* COMUNITARIAS */

#community{
  position:absolute;
  top:45%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* CONTROLES */

#controls{
  margin-top:15px;
}

button{
  padding:10px 18px;
  margin:6px;
  font-size:15px;
  cursor:pointer;
  border-radius:8px;
  border:none;
  background:#444;
  color:white;
  transition:0.2s;
}

button:hover{
  background:#666;
}

button.primary{
  background:#3fa9f5;
}

button.danger{
  background:#ff4d4d;
}

</style>
</head>
<body>

<h1>♠ Texas Hold'em ♣</h1>

<div id="pot">Pozo: $0</div>
<div id="winnerText"></div>

<div id="table">
  <div id="community"></div>
</div>

<div id="controls">
  <button onclick="check()">Check</button>
  <button class="primary" onclick="bet(5)">Min ($5)</button>
  <button class="primary" onclick="bet(10)">Max ($10)</button>
  <button class="danger" onclick="fold()">Fold</button>
</div>

<script>

const socket = io();
let myId = null;
let currentTurn = null;
let revealCards = false;

socket.on("connect",()=>{
  myId = socket.id;
});

socket.on("update",data=>{

  currentTurn = data.gameState.turn;
  revealCards = data.gameState.reveal;

  document.getElementById("pot").innerText =
    "Pozo: $" + data.gameState.pot;

  renderCommunity(data.gameState.community);
  renderPlayers(data.players,data.gameState);
});

socket.on("showdown",data=>{
  document.getElementById("winnerText").innerText =
    "Ganador: " + getPlayerName(data.winner) +
    " con " + data.description;
});

function getPlayerName(id){
  const seats=document.querySelectorAll(".seat");
  for(let s of seats){
    if(s.dataset.id===id) return s.dataset.name;
  }
  return "";
}

function renderCommunity(cards){
  const div=document.getElementById("community");
  div.innerHTML="";
  cards.forEach(c=>div.appendChild(createCard(c)));
}

function createCard(text){
  const suit=text.slice(-1);
  const value=text.slice(0,-1);
  const color=(suit==="♥"||suit==="♦")?"red":"black";

  const div=document.createElement("div");
  div.className="card "+color;

  div.innerHTML=`
    <div class="top">${value}${suit}</div>
    <div class="center">${suit}</div>
    <div class="bottom">${value}${suit}</div>
  `;
  return div;
}

function renderPlayers(players,gameState){

  document.querySelectorAll(".seat").forEach(e=>e.remove());

  const positions=[
    {top:"5%",left:"45%"},
    {top:"20%",left:"80%"},
    {top:"65%",left:"80%"},
    {top:"80%",left:"45%"},
    {top:"65%",left:"5%"},
    {top:"20%",left:"5%"}
  ];

  players.forEach((p,index)=>{

    const seat=document.createElement("div");
    seat.className="seat";
    seat.style.top=positions[index].top;
    seat.style.left=positions[index].left;
    seat.dataset.id=p.id;
    seat.dataset.name=p.name;

    if(p.id===currentTurn)
      seat.classList.add("turn");

    /* ROLES */
    if(index===gameState.dealerIndex){
      seat.innerHTML+=`<div class="role dealer">D</div>`;
    }
    if(index===gameState.sbIndex){
      seat.innerHTML+=`<div class="role sb">SB</div>`;
    }
    if(index===gameState.bbIndex){
      seat.innerHTML+=`<div class="role bb">BB</div>`;
    }

    seat.innerHTML+=`<div><b>${p.name}</b></div>`;
    seat.innerHTML+=`<div>$${p.money}</div>`;

    if(p.id===myId || revealCards){
      p.cards.forEach(c=>seat.appendChild(createCard(c)));
    }else if(!p.folded){
      seat.innerHTML+=`
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      `;
    }

    document.getElementById("table").appendChild(seat);
  });
}

function bet(amount){
  socket.emit("bet",amount);
}

function check(){
  socket.emit("bet",0);
}

function fold(){
  socket.emit("fold");
}

</script>

</body>
</html>
